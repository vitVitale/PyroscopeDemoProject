{"version":3,"file":"377.js?_cache=ca03625d5daff36cb068","mappings":"gRAqBA,SAASA,EAAYC,GACnB,MAAoB,iBAATA,GAAqBC,EAAAA,SAASC,aAAaF,GAE7CA,EAGFC,EAAAA,SAASE,WAAW,IAAIC,KAAKJ,GAAO,CAAEK,SAAS,IAAUC,aAClE,CCRA,MAuCA,EAvCuB,EAAGC,QAAOC,eAAcC,aAAYC,iBACzD,MAAOC,IAASC,EAAAA,EAAAA,MACTC,EAAmBC,IAAwBC,EAAAA,EAAAA,UAAmC,MAC/EC,GAAUC,EAAAA,EAAAA,SAAO,GAavB,IAXAC,EAAAA,EAAAA,WAAU,KACHF,EAAQG,UACXH,EAAQG,SAAU,GAClBC,EAAAA,EAAAA,GAAqB,2BAA4B,CAAEC,UAAW,sBAE/D,KAEHH,EAAAA,EAAAA,WAAU,MACRI,EAAAA,EAAAA,IAAiBf,GAAOgB,KAAKT,IAC5B,CAACP,KAECM,EACH,OAAO,kBAACW,MAAAA,KAAI,cAGd,MAAMC,GAAQC,EAAAA,EAAAA,IAAgB,CAC5BC,OAAQd,EAAkBc,OAC1BC,UAAWlB,EAAWmB,IACtBC,eAAgBjB,EAAkBkB,OAAOC,IAAI,EAAGC,QAAOC,KAAIC,YAAa,CACtEC,IAAKH,EACLI,SAAUH,EACVC,WAEFG,YDI6BC,ECJA/B,EDIiCgC,ECJnB/B,EDKtC,IAAIgC,EAAAA,GAAe,CAAEF,KAAMxC,EAAYwC,GAAOC,GAAIzC,EAAYyC,MCJnEE,UAAU,IDGP,IAA0BH,EAAiCC,ECAhE,OACE,kBAAChB,MAAAA,CAAImB,cAAY,8CACdhC,EAAQ,kBAACiC,EAAAA,EAASA,CAACjC,MAAOA,IAAY,kBAACkC,EAAAA,EAAKA,CAACpB,MAAOA,K","sources":["webpack://grafana-metricsdrilldown-app/./shared/utils/utils.timerange.ts","webpack://grafana-metricsdrilldown-app/./exposedComponents/LabelBreakdown/LabelBreakdown.tsx"],"sourcesContent":["import { dateMath } from '@grafana/data';\nimport { SceneTimeRange } from '@grafana/scenes';\n\ntype MathStringOrUnixTimestamp = string | number;\n\n/**\n * Convert a time string or unix timestamp to a SceneTimeRange.\n *\n * @param time - The time string or unix timestamp.\n * @returns The SceneTimeRange.\n *\n * @example\n * ```ts\n * toSceneTime('now-1h')\n * ```\n *\n * @example\n * ```ts\n * toSceneTime(1723756800000)\n * ```\n */\nfunction toSceneTime(time: MathStringOrUnixTimestamp): string {\n  if (typeof time === 'string' && dateMath.isMathString(time)) {\n    // 'now', 'now-1h', etc.\n    return time;\n  }\n\n  return dateMath.toDateTime(new Date(time), { roundUp: false })!.toISOString();\n}\n\n/**\n * Convert a time string or unix timestamp to a SceneTimeRange.\n *\n * @param from - The start time.\n * @param to - The end time.\n * @returns The SceneTimeRange.\n *\n * @example\n * ```ts\n * toSceneTimeRange('now-1h', 'now')\n * ```\n *\n * @example\n * ```ts\n * toSceneTimeRange(1723756800000, 1723756800000)\n * ```\n *\n * @example\n * ```ts\n * toSceneTimeRange('now-1h', 1723756800000)\n * ```\n */\nexport function toSceneTimeRange(from: MathStringOrUnixTimestamp, to: MathStringOrUnixTimestamp): SceneTimeRange {\n  return new SceneTimeRange({ from: toSceneTime(from), to: toSceneTime(to) });\n}\n","import { type DataSourceApi } from '@grafana/data';\nimport React, { useEffect, useRef, useState } from 'react';\n\nimport { ErrorView } from 'App/ErrorView';\nimport { Trail } from 'App/Routes';\nimport { useCatchExceptions } from 'App/useCatchExceptions';\nimport { reportExploreMetrics } from 'shared/tracking/interactions';\nimport { newMetricsTrail } from 'shared/utils/utils';\nimport { type ParsedPromQLQuery } from 'shared/utils/utils.promql';\n\nimport { parsePromQLQuery } from '../../extensions/links';\nimport { toSceneTimeRange } from '../../shared/utils/utils.timerange';\n\nexport interface LabelBreakdownProps {\n  query: string;\n  initialStart: string | number;\n  initialEnd: string | number;\n  dataSource: DataSourceApi;\n}\n\nconst LabelBreakdown = ({ query, initialStart, initialEnd, dataSource }: LabelBreakdownProps) => {\n  const [error] = useCatchExceptions();\n  const [parsedPromQLQuery, setParsedPromQLQuery] = useState<ParsedPromQLQuery | null>(null);\n  const initRef = useRef(false);\n\n  useEffect(() => {\n    if (!initRef.current) {\n      initRef.current = true;\n      reportExploreMetrics('exposed_component_viewed', { component: 'label_breakdown' });\n    }\n  }, []);\n\n  useEffect(() => {\n    parsePromQLQuery(query).then(setParsedPromQLQuery);\n  }, [query]);\n\n  if (!parsedPromQLQuery) {\n    return <div>Loading...</div>;\n  }\n\n  const trail = newMetricsTrail({\n    metric: parsedPromQLQuery.metric,\n    initialDS: dataSource.uid,\n    initialFilters: parsedPromQLQuery.labels.map(({ label, op, value }) => ({\n      key: label,\n      operator: op,\n      value,\n    })),\n    $timeRange: toSceneTimeRange(initialStart, initialEnd),\n    embedded: true,\n  });\n\n  return (\n    <div data-testid=\"metrics-drilldown-embedded-label-breakdown\">\n      {error ? <ErrorView error={error} /> : <Trail trail={trail} />}\n    </div>\n  );\n};\n\nexport default LabelBreakdown;\n"],"names":["toSceneTime","time","dateMath","isMathString","toDateTime","Date","roundUp","toISOString","query","initialStart","initialEnd","dataSource","error","useCatchExceptions","parsedPromQLQuery","setParsedPromQLQuery","useState","initRef","useRef","useEffect","current","reportExploreMetrics","component","parsePromQLQuery","then","div","trail","newMetricsTrail","metric","initialDS","uid","initialFilters","labels","map","label","op","value","key","operator","$timeRange","from","to","SceneTimeRange","embedded","data-testid","ErrorView","Trail"],"sourceRoot":""}